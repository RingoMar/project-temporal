"use strict";(self.webpackChunkproject_temporal=self.webpackChunkproject_temporal||[]).push([[7533],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>h});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(a),d=o,h=c["".concat(s,".").concat(d)]||c[d]||m[d]||r;return a?n.createElement(h,i(i({ref:t},u),{},{components:a})):n.createElement(h,i({ref:t},u))}));function h(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:o,i[1]=l;for(var p=2;p<r;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},1029:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var n=a(7462),o=(a(7294),a(3905));const r={sidebar_position:1},i="Get M3U8 Links",l={unversionedId:"tutorial-bot/get-m3u8",id:"tutorial-bot/get-m3u8",title:"Get M3U8 Links",description:"We can use the Twitch api itself and get m3u8 links without having todo much work or going to the API itself",source:"@site/docs/tutorial-bot/get-m3u8.md",sourceDirName:"tutorial-bot",slug:"/tutorial-bot/get-m3u8",permalink:"/project-temporal/docs/tutorial-bot/get-m3u8",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"defaultSidebar",previous:{title:"Project - Setup",permalink:"/project-temporal/docs/category/project---setup"},next:{title:"Whisper Implementation",permalink:"/project-temporal/docs/tutorial-bot/whisper"}},s={},p=[{value:"Create the a post funtion",id:"create-the-a-post-funtion",level:2},{value:"Download and segment the audio",id:"download-and-segment-the-audio",level:2},{value:"How the ffmpeg command works in this case",id:"how-the-ffmpeg-command-works-in-this-case",level:3}],u={toc:p};function c(e){let{components:t,...r}=e;return(0,o.kt)("wrapper",(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"get-m3u8-links"},"Get M3U8 Links"),(0,o.kt)("p",null,"We can use the Twitch api itself and get m3u8 links without having todo much work or going to the API itself"),(0,o.kt)("admonition",{title:"Purple Screen of death!",type:"info"},(0,o.kt)("p",{parentName:"admonition"},'When using a direct M3U8 link to watch a Twitch stream, you will still see a colorful "commercial break in progress" screen. This is becuse we are not logged in with a Twitch Turbo account or subscribed to the stream. There are ways todo this such using the links found on twitch itself or adding configurations to the link. This problem doesnt bother us but somoene can always imporve on it in the future.')),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"purp screen",src:a(8619).Z,width:"1921",height:"1080"})),(0,o.kt)("h2",{id:"create-the-a-post-funtion"},"Create the a post funtion"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-py",metastring:'title="getm3u8.py"',title:'"getm3u8.py"'},"import json\nimport requests\nimport urllib.parse\n\nquote = urllib.parse.quote\nCHANNEL_NAME = \"kappa\" # The channel you want here\nCLIENT_ID = \"1234567890\" #Your Client Id here\n\ndata = {'operationName': 'PlaybackAccessToken_Template', 'query': 'query PlaybackAccessToken_Template($login: String!, $isLive: Boolean!, $vodID: ID!, $isVod: Boolean!, $playerType: String!) {  streamPlaybackAccessToken(channelName: $login, params: {platform: \"web\", playerBackend: \"mediaplayer\", playerType: $playerType}) @include(if: $isLive) {    value    signature    __typename  }  videoPlaybackAccessToken(id: $vodID, params: {platform: \"web\", playerBackend: \"mediaplayer\", playerType: $playerType}) @include(if: $isVod) {    value    signature    __typename  }}', 'variables': {'isLive': True, 'login': CHANNEL_NAME.lower(), 'isVod': False, 'vodID': '', 'playerType': 'site'}}\n\naccess = requests.post('https://gql.twitch.tv/gql', headers={\"client-id\": CLIENT_ID}, data=json.dumps(data),  timeout=10).json()\n\nsignature = access['data']['streamPlaybackAccessToken']['signature']\ntoken = access['data']['streamPlaybackAccessToken']['value']\n\nurl = ('https://usher.ttvnw.net/api/channel/hls/'+CHANNEL_NAME+'.m3u8' + '?sig='+signature + '&token='+quote(token))\n\nprint(url)\n\n")),(0,o.kt)("h2",{id:"download-and-segment-the-audio"},"Download and segment the audio"),(0,o.kt)("p",null,"Using ffmepg we can complate this action. ",(0,o.kt)("a",{parentName:"p",href:"https://img.ly/blog/ultimate-guide-to-ffmpeg/"},"Learn More")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-console"},"ffmpeg -i https://example.com/index.m3u8 -vn -c:a aac -b:a 128k -segment_time 10 -f segment audio/output_%03d.aac\n")),(0,o.kt)("p",null,"This can be added stright into our python file just like this replacing ",(0,o.kt)("inlineCode",{parentName:"p"},"https://example.com/index.m3u8")," with the url we got like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="getm3u8.py"',title:'"getm3u8.py"'},'import os \nos.system(f"ffmpeg -i \\"{url}\\" -vn -c:a aac -b:a 128k -segment_time 10 -f segment audio/output_%03d.aac")\n')),(0,o.kt)("h3",{id:"how-the-ffmpeg-command-works-in-this-case"},"How the ffmpeg command works in this case"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},'The "-i" flag specifies the input file, and the options following it are used to configure the output.')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},'The "-vn" flag disables video recording, meaning only audio will be extracted from the input. '),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},'The "-c:a aac" flag specifies that the audio codec used should be AAC. '),(0,o.kt)("li",{parentName:"ul"},'The "-b:a 128k" flag sets the audio bitrate to 128 kbps.'))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},'The "-segment_time 10" flag tells FFmpeg to segment the output into 10-second chunks. '),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"The -f segment flag tells ffmpeg to use the segment muxer to split the input into time-limited files."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},'Finally, the output file is specified as "audio/output_%03d.aac", which tells FFmpeg to save the output as a series of AAC files in the "audio" directory, each one numbered in sequence (e.g. "output_001.aac", "output_002.aac", etc.).'))))}c.isMDXComponent=!0},8619:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/ShareX_1674247593-6057ee0e5923a119ecb1d0b554005e16.png"}}]);